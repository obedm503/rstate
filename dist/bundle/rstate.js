!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.Rstate=t.Rstate||{})}(this,function(t){"use strict";function r(t,r){return r={exports:{}},t(r,r.exports),r.exports}function e(){try{return a.apply(this,arguments)}catch(t){return _.errorObject.e=t,_.errorObject}}function n(t){return t.reduce(function(t,r){return t.concat(r instanceof S.UnsubscriptionError?r.errors:r)},[])}function o(t,r){if("$end"===t&&(t=r.length-1),!/^\+?\d+$/.test(t))throw Error("Array index '"+t+"' has to be an integer");return parseInt(t)}function i(t){return t.replace(/\\\./g,"@").replace(/\./g,"*").replace(/@/g,".").split("*")}var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c="undefined"!=typeof window&&window,u="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,h=void 0!==s&&s,b=c||h||u,p=b;!function(){if(!b)throw Error("RxJS could not find any global context (window, self, global)")}();var a,f={root:p},l={isFunction:function(t){return"function"==typeof t}},y={isArray:Array.isArray||function(t){return t&&"number"==typeof t.length}},d={isObject:function(t){return null!=t&&"object"==typeof t}},_={errorObject:{e:{}}},v={tryCatch:function(t){return a=t,e}},w=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},S={UnsubscriptionError:function(t){function r(r){t.call(this),this.errors=r;var e=Error.call(this,r?r.length+" errors occurred during unsubscription:\n  "+r.map(function(t,r){return r+1+") "+t}).join("\n  "):"");this.name=e.name="UnsubscriptionError",this.stack=e.stack,this.message=e.message}return w(r,t),r}(Error)},E={Subscription:function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,r=!1;if(!this.closed){var e=this,o=e._parent,i=e._parents,s=e._unsubscribe,c=e._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var u=-1,h=i?i.length:0;o;)o.remove(this),o=++u<h&&i[u]||null;if(l.isFunction(s)&&(p=v.tryCatch(s).call(this))===_.errorObject&&(r=!0,t=t||(_.errorObject.e instanceof S.UnsubscriptionError?n(_.errorObject.e.errors):[_.errorObject.e])),y.isArray(c))for(u=-1,h=c.length;++u<h;){var b=c[u];if(d.isObject(b)){var p=v.tryCatch(b.unsubscribe).call(b);if(p===_.errorObject){r=!0,t=t||[];var a=_.errorObject.e;a instanceof S.UnsubscriptionError?t=t.concat(n(a.errors)):t.push(a)}}}if(r)throw new S.UnsubscriptionError(t)}},t.prototype.add=function(r){if(!r||r===t.EMPTY)return t.EMPTY;if(r===this)return this;var e=r;switch(typeof r){case"function":e=new t(r);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if("function"!=typeof e._addParent){var n=e;(e=new t)._subscriptions=[n]}break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(e),e._addParent(this),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.prototype._addParent=function(t){var r=this,e=r._parent,n=r._parents;e&&e!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}()},O={empty:{closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}}},x=r(function(t,r){var e=f.root.Symbol;r.rxSubscriber="function"==typeof e&&"function"==typeof e.for?e.for("rxSubscriber"):"@@rxSubscriber",r.$$rxSubscriber=r.rxSubscriber}),g=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},j=function(t){function r(e,n,o){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=O.empty;break;case 1:if(!e){this.destination=O.empty;break}if("object"==typeof e){e instanceof r?(this.destination=e).add(this):(this.syncErrorThrowable=!0,this.destination=new P(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new P(this,e,n,o)}}return g(r,t),r.prototype[x.rxSubscriber]=function(){return this},r.create=function(t,e,n){var o=new r(t,e,n);return o.syncErrorThrowable=!1,o},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this,r=t._parent,e=t._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=r,this._parents=e,this},r}(E.Subscription),m=j,P=function(t){function r(r,e,n,o){t.call(this),this._parentSubscriber=r;var i,s=this;l.isFunction(e)?i=e:e&&(i=e.next,n=e.error,o=e.complete,e!==O.empty&&(s=Object.create(e),l.isFunction(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=i,this._error=n,this._complete=o}return g(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber;if(this._error)r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!r.syncErrorThrowable)throw this.unsubscribe(),t;r.syncErrorValue=t,r.syncErrorThrown=!0,this.unsubscribe()}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){throw this.unsubscribe(),t}},r.prototype.__tryOrSetError=function(t,r,e){try{r.call(this._context,e)}catch(r){return t.syncErrorValue=r,t.syncErrorThrown=!0,!0}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(j),T={Subscriber:m},U={toSubscriber:function(t,r,e){if(t){if(t instanceof T.Subscriber)return t;if(t[x.rxSubscriber])return t[x.rxSubscriber]()}return t||r||e?new T.Subscriber(t,r,e):new T.Subscriber(O.empty)}},A=r(function(t,r){function e(t){var r,e=t.Symbol;return"function"==typeof e?e.observable?r=e.observable:(r=e("observable"),e.observable=r):r="@@observable",r}r.getSymbolObservable=e,r.observable=e(f.root),r.$$observable=r.observable}),k={Observable:function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,o=U.toSubscriber(t,r,e);if(n?n.call(o,this.source):o.add(this.source?this._subscribe(o):this._trySubscribe(o)),o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.syncErrorThrown=!0,t.syncErrorValue=r,t.error(r)}},t.prototype.forEach=function(t,r){var e=this;if(r||(f.root.Rx&&f.root.Rx.config&&f.root.Rx.config.Promise?r=f.root.Rx.config.Promise:f.root.Promise&&(r=f.root.Promise)),!r)throw Error("no Promise impl found");return new r(function(r,n){var o;o=e.subscribe(function(r){if(o)try{t(r)}catch(t){n(t),o.unsubscribe()}else t(r)},n,r)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[A.observable]=function(){return this},t.create=function(r){return new t(r)},t}()},$=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},R={ObjectUnsubscribedError:function(t){function r(){var r=t.call(this,"object unsubscribed");this.name=r.name="ObjectUnsubscribedError",this.stack=r.stack,this.message=r.message}return $(r,t),r}(Error)},V=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},M={SubjectSubscription:function(t){function r(r,e){t.call(this),this.subject=r,this.subscriber=e,this.closed=!1}return V(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},r}(E.Subscription)},Y=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},C=function(t){function r(r){t.call(this,r),this.destination=r}return Y(r,t),r}(T.Subscriber),F=C,G=function(t){function r(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return Y(r,t),r.prototype[x.rxSubscriber]=function(){return new C(this)},r.prototype.lift=function(t){var r=new W(this,this);return r.operator=t,r},r.prototype.next=function(t){if(this.closed)throw new R.ObjectUnsubscribedError;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),o=0;e>o;o++)n[o].next(t)},r.prototype.error=function(t){if(this.closed)throw new R.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),o=0;e>o;o++)n[o].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new R.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;r>n;n++)e[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(r){if(this.closed)throw new R.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){if(this.closed)throw new R.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),E.Subscription.EMPTY):this.isStopped?(t.complete(),E.Subscription.EMPTY):(this.observers.push(t),new M.SubjectSubscription(this,t))},r.prototype.asObservable=function(){var t=new k.Observable;return t.source=this,t},r.create=function(t,r){return new W(t,r)},r}(k.Observable),H=G,W=function(t){function r(r,e){t.call(this),this.destination=r,this.source=e}return Y(r,t),r.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},r.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):E.Subscription.EMPTY},r}(G),I={SubjectSubscriber:F,Subject:H,AnonymousSubject:W},N=s&&s.__extends||function(t,r){function e(){this.constructor=t}for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)},z=function(t){function r(r){t.call(this),this._value=r}return N(r,t),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(r){var e=t.prototype._subscribe.call(this,r);return e&&!e.closed&&r.next(this._value),e},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new R.ObjectUnsubscribedError;return this._value},r.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},r}(I.Subject),D=function(t,r,e){r="number"==typeof r?i(""+r):"string"==typeof r?i(r):r;var n=function(t,r,e,i){var s,c=r[i];return r.length>i?(Array.isArray(t)?(c=o(c,t),s=t.slice()):s=Object.assign({},t),s[c]=n(void 0!==t[c]?t[c]:{},r,e,i+1),s):"function"==typeof e?e(t):e};return n(t,r,e,0)},J=function(t,r){r="number"==typeof r?i(""+r):"string"==typeof r?i(r):r;for(var e=0;r.length>e;e++){if("object"!=typeof t)return;var n=r[e];Array.isArray(t)&&"$end"===n&&(n=t.length-1),t=t[n]}return t},q=function(t){return t&&"object"==typeof t&&!Array.isArray(t)},B=Object.assign||function(t){for(var r,e=1,n=arguments.length;n>e;e++){r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},K=Object.assign||function(t){for(var r,e=1,n=arguments.length;n>e;e++){r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},L=function(){function t(t,r){if(this.handlers={},void 0===t)throw Error("Rstate: no action handlers provided");this.handlers=t,this.bhs$=new z(r),this.state=this.bhs$.asObservable(),this.subscribe=this.state.subscribe.bind(this.state)}return t.prototype.dispatch=function(t){var r=this;if(void 0===t)throw Error("No Action Given");var e=Object.keys(this.handlers),n=e.filter(function(r){return r===t.type||r.startsWith(t.type)&&"@"===r[t.type.length]});if(0===n.length){var o=e.map(function(t){return'  "'+t+'"'}).join(", \n");throw Error('Action handler of type "'+t.type+'" does not exist.\nIt is possible that you mispelled the action type.\n\nThe currently registered action types are:\n'+o+"\n")}n.forEach(function(e){var n=r.handlers[e],o=e.split("@")[1],i=!1,s=n(o?J(r.getState(),o):r.getState(),t,function(t){i=!0,r.dispatch(t)});if(void 0!==s){if(i)throw Error('"'+e+'": You may not return new state AND dispatch in the same handler.\nConsider dividing your logic between a Procedure and a Reducer.');r.bhs$.next(o?D(r.getState(),o,s):s)}})},t.prototype.getState=function(){return this.bhs$.getValue()},t.prototype.replaceHandlers=function(t){void 0===t&&(t={}),this.handlers=K({},this.handlers,t)},t}();t.Store=L,t.createStore=function(t,r){return new L(t,r)},t.combineHandlers=function(t){function r(t,e,n){var o={},i=n?n+"."+e:e;return Object.keys(t).forEach(function(e){var n,s=t[e];q(s)?n=r(s,e,i):((c={})[i?e+"@"+i:e]=s,n=c),o=B({},o,n);var c}),o}if(!q(t))throw Error("combineHandlers expected action handlers to be object literal");return r(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=rstate.js.map
